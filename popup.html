<style>
body { overflow-x:hidden; }
a { display:block; padding-left:5px; height:24px; line-height:24px; white-space:nowrap; color:black; text-decoration:none; }
a.active { font-weight:bolder; }
a span { margin-left:5px; font-size:12px; vertical-align:middle; line-height:24px; height:24px; }
a img { vertical-align:middle; height:16px; width:16px; padding-top:4px; padding-bottom:4px; }
a:hover { background-color:#dfe6f6; } 
</style>
<!-- <script src="jquery-1.3.2.min.js"></script> -->
<script>
  var tabInfo = {
    tabList: new Array,
    tabCurrent: new Object
  }

  String.prototype.truncate = function (maxChars) {
    if (typeof maxChars === 'undefined')
      var maxChars = 64;
    if (this && this.length > maxChars) return this.substring(0, maxChars) + '...'; else return this;
  }
  Array.prototype.findByTabId = function (tabId) {
    for(var i=0;i<this.length;i++) {
      if (this[i].id == tabId)
        return this[i];
    }
  }

  function makeEntry(tab) {
    var text = document.createElement('span');
    var link = document.createElement('a');
    var favIcon = new Image();

    var title = tab.title.truncate();
    var url = tab.url;

    favIcon.src = tab.favIconUrl;
    favIcon.alt = 'favIcon'

    text.textContent = title;

    link.setAttribute('href', url);
    link.setAttribute('id', tab.id)

    link.appendChild(favIcon);
    link.appendChild(text);

    if (tab.selected) link.className += ' active';

    return link;
  }
  function setActive(tab) {
  
  }
  function init() {
    var tabs = window.tabInfo.tabList;

    var box = document.getElementById('content');

    for(var i=0;i<tabs.length;i++) {
      if (tabs[i].selected) tabInfo.tabCurrent = tabs[i];
      if (tabs[i].status == 'complete') {
        var link = makeEntry(tabs[i]);
        box.appendChild(link);

        link.onclick = function (e) {
          e.preventDefault(); 
          var tabId = parseInt(this.getAttribute('id'));
          chrome.tabs.update(tabId, {selected:true}, function cb(tab){
            setActive(tab);
          })
          //console.log("clicked");
          //console.log(window.tabList.findByTabId(tabId));
          //chrome.tabs.update(tabInfo.tabCurrent.id, {selected:false});
          //chrome.tabs.update(tabId, {selected:true});
          //tabInfo.tabCurrent = tabInfo.findByTabId(tabId);
          //console.log(window.tabs);
        }
      }
    }
  
  }
  /* populates window.tabInfo.tabList with the current tab list,
     and sets window.tabInfo.tabCurrent to the current tab */

  chrome.tabs.getAllInWindow(null, function f(tabs) { tabInfo.tabList = tabs; init(); });
</script>
<body>
  <div id="content">
  </div>
</body>

